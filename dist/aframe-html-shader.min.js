!function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){return{status:"error",target:e,message:t,timestamp:Date.now()}}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a=n(1),u=r(a);if("undefined"==typeof AFRAME)throw"Component attempted to register before AFRAME was available.";var s=AFRAME.utils.debug;s.enable("shader:html:warn");var c=s("shader:html:warn"),h=s("shader:html:debug");AFRAME.registerShader("html",{schema:{color:{type:"color"},fog:{default:!0},target:{default:null},debug:{default:null},fps:{type:"number",default:0},width:{default:null},height:{default:null},ratio:{default:null}},init:function(t){return h("init",t),this.__cnv=document.createElement("canvas"),this.__cnv.width=2,this.__cnv.height=2,this.__ctx=this.__cnv.getContext("2d"),this.__texture=new THREE.Texture(this.__cnv),this.__reset(),this.material=new THREE.MeshBasicMaterial({map:this.__texture}),this.el.sceneEl.addBehavior(this),this.material},update:function(t){return h("update",t),this.__updateMaterial(t),this.__updateTexture(t),this.material},tick:function(t){if(!this.__paused&&this.__target&&this.__nextTime){var e=Date.now();e>this.__nextTime&&this.__render()}},__updateMaterial:function(t){var e=this.material,n=this.__getMaterialData(t);Object.keys(n).forEach(function(t){e[t]=n[t]})},__getMaterialData:function(t){return{fog:t.fog,color:new THREE.Color(t.color)}},__setTexure:function(t){h("__setTexure",t),"error"===t.status?(c("Error: "+t.message+"\ntarget: "+t.target),this.__reset()):"success"===t.status&&t.target!==this.__textureSrc&&this.__ready(t)},__updateTexture:function(t){var e=this,n=t.target,r=t.fps,i=t.width,o=t.height,a=t.ratio;this.__width=i||this.schema.width.default,this.__height=o||this.schema.height.default;var u=function(){e.__debugEl&&(e.__debugEl.innerHTML="",e.__debugEl=e.schema.debug.default)};if(t.debug){var s=this.__validateAndGetQuerySelector(t.debug);s&&!s.error?this.__debugEl=s:u()}else u();if(a&&"width"===a||"height"===a?this.__ratio=a:this.__ratio=this.schema.ratio.default,r)if(this.__fps>0)this.__fps=r;else if(r===-1){this.__fps=this.schema.fps.default,this.__target&&this.__render();var c=Object.assign({},this.el.getAttribute("material"));delete c.fps,this.el.setAttribute("material",c)}else this.__fps=r,this.__target&&(this.play(),this.__render());else this.__fps>0?this.pause():this.__fps=this.schema.fps.default;if(n){if(n===this.__target)return;this.__target=n,this.__validateSrc(n,this.__setTexure.bind(this))}else this.__reset()},__validateSrc:function(t,e){var n=void 0,r=this.__validateAndGetQuerySelector(t);if(r&&"object"===("undefined"==typeof r?"undefined":o(r))){if(r.error)n=r.error;else{var a=r.tagName.toLowerCase();"img"===a||"video"===a?n="For <"+a+"> element, please use `shader:flat`":e({status:"success",target:t,targetEl:r,timestamp:Date.now()})}if(n){var u=i(n,t);e(u)}}},__validateAndGetQuerySelector:function(t){try{var e=document.querySelector(t);return e?e:{error:"No element was found matching the selector"}}catch(t){return{error:"no valid selector"}}},pause:function(){h("pause"),this.__paused=!0,this.__nextTime=null},play:function(){h("play"),this.__paused=!1},togglePlayback:function(){this.paused()?this.play():this.pause()},paused:function(){return this.__paused},__clearCanvas:function(){this.__ctx&&this.__texture&&(this.__ctx.clearRect(0,0,this.__width,this.__height),this.__texture.needsUpdate=!0)},__draw:function(t){if(h("__draw"),this.__ctx&&this.__texture){var e=t.width/t.height,n=this.__cnv.width=THREE.Math.floorPowerOfTwo(t.width),r=this.__cnv.height=THREE.Math.floorPowerOfTwo(t.height);if(this.__ctx.drawImage(t,0,0,n,r),this.__texture.needsUpdate=!0,this.__ratio){var i=this.el.getObject3D("mesh").geometry.metadata.parameters,o=i.width,a=i.height;this.el.setAttribute("geometry",Object.assign({},this.el.getAttribute("geometry"),{width:"width"===this.__ratio?o:a*e,height:"width"===this.__ratio?o/e:a}))}this.__debugEl?(this.__debugEl.innerHTML="",this.__debugEl.appendChild(t)):(t.height=0,t.width=0,t.remove()),this.__setNextTick()}},__render:function(){var t=this;if(this.__nextTime=null,this.__targetEl){var e=this.__targetEl.getBoundingClientRect(),n=e.width,r=e.height,i={width:this.__width||n,height:this.__height||r};u.default.toPng(this.__targetEl,i).then(function(e){return u.default.toPng(t.__targetEl,i)}).then(function(e){return u.default.toPng(t.__targetEl,i)}).then(function(t){return new Promise(function(e,n){var r=new Image,i=function t(){r.removeEventListener("load",t),r.removeEventListener("error",o),e(r)},o=function t(e){r.removeEventListener("load",i),r.removeEventListener("error",t),n(e)};r.addEventListener("load",i),r.addEventListener("error",o),r.src=t})}).then(function(t){var e=document.createElement("canvas");e.width=i.width,e.height=i.height;var n=e.getContext("2d",{storage:"discardable"});return n.drawImage(t,0,0),e}).then(this.__draw.bind(this))}},__setNextTick:function(){this.__fps>0&&(this.__nextTime=Date.now()+1e3/this.__fps)},__ready:function(t){var e=t.target,n=t.targetEl;h("__ready"),this.__target=e,this.__targetEl=n,this.play(),this.__render()},__reset:function(){this.pause(),this.__clearCanvas(),this.__target=null,this.__targetEl=null,this.__debugEl=null},dispose:function(){h("dispose"),this.el.sceneEl.removeBehavior(this),this.__cnv&&(this.__cnv.width=0,this.__cnv.height=0,this.__cnv=null),this.__texture&&(this.__texture.dispose(),this.__texture=null)}})},function(t,e,n){!function(e){"use strict";function n(t,e){function n(t){return e.bgcolor&&(t.style.backgroundColor=e.bgcolor),e.width&&(t.style.width=e.width+"px"),e.height&&(t.style.height=e.height+"px"),e.style&&Object.keys(e.style).forEach(function(n){t.style[n]=e.style[n]}),t}return e=e||{},u(e),Promise.resolve(t).then(function(t){return c(t,e.filter,!0)}).then(h).then(l).then(n).then(function(n){return f(n,e.width||p.width(t),e.height||p.height(t))})}function r(t,e){return s(t,e||{}).then(function(e){return e.getContext("2d").getImageData(0,0,p.width(t),p.height(t)).data})}function i(t,e){return s(t,e||{}).then(function(t){return t.toDataURL()})}function o(t,e){return e=e||{},s(t,e).then(function(t){return t.toDataURL("image/jpeg",e.quality||1)})}function a(t,e){return s(t,e||{}).then(p.canvasToBlob)}function u(t){"undefined"==typeof t.imagePlaceholder?E.impl.options.imagePlaceholder=b.imagePlaceholder:E.impl.options.imagePlaceholder=t.imagePlaceholder,"undefined"==typeof t.cacheBust?E.impl.options.cacheBust=b.cacheBust:E.impl.options.cacheBust=t.cacheBust}function s(t,e){function r(t){var n=document.createElement("canvas");if(n.width=e.width||p.width(t),n.height=e.height||p.height(t),e.bgcolor){var r=n.getContext("2d");r.fillStyle=e.bgcolor,r.fillRect(0,0,n.width,n.height)}return n}return n(t,e).then(p.makeImage).then(p.delay(100)).then(function(e){var n=r(t);return n.getContext("2d").drawImage(e,0,0),n})}function c(t,e,n){function r(t){return t instanceof HTMLCanvasElement?p.makeImage(t.toDataURL()):t.cloneNode(!1)}function i(t,e,n){function r(t,e,n){var r=Promise.resolve();return e.forEach(function(e){r=r.then(function(){return c(e,n)}).then(function(e){e&&t.appendChild(e)})}),r}var i=t.childNodes;return 0===i.length?Promise.resolve(e):r(e,p.asArray(i),n).then(function(){return e})}function o(t,e){function n(){function n(t,e){function n(t,e){p.asArray(t).forEach(function(n){e.setProperty(n,t.getPropertyValue(n),t.getPropertyPriority(n))})}t.cssText?e.cssText=t.cssText:n(t,e)}n(window.getComputedStyle(t),e.style)}function r(){function n(n){function r(t,e,n){function r(t){var e=t.getPropertyValue("content");return t.cssText+" content: "+e+";"}function i(t){function e(e){return e+": "+t.getPropertyValue(e)+(t.getPropertyPriority(e)?" !important":"")}return p.asArray(t).map(e).join("; ")+";"}var o="."+t+":"+e,a=n.cssText?r(n):i(n);return document.createTextNode(o+"{"+a+"}")}var i=window.getComputedStyle(t,n),o=i.getPropertyValue("content");if(""!==o&&"none"!==o){var a=p.uid();e.className=e.className+" "+a;var u=document.createElement("style");u.appendChild(r(a,n,i)),e.appendChild(u)}}[":before",":after"].forEach(function(t){n(t)})}function i(){t instanceof HTMLTextAreaElement&&(e.innerHTML=t.value),t instanceof HTMLInputElement&&e.setAttribute("value",t.value)}function o(){e instanceof SVGElement&&(e.setAttribute("xmlns","http://www.w3.org/2000/svg"),e instanceof SVGRectElement&&["width","height"].forEach(function(t){var n=e.getAttribute(t);n&&e.style.setProperty(t,n)}))}return e instanceof Element?Promise.resolve().then(n).then(r).then(i).then(o).then(function(){return e}):e}return n||!e||e(t)?Promise.resolve(t).then(r).then(function(n){return i(t,n,e)}).then(function(e){return o(t,e)}):Promise.resolve()}function h(t){return w.resolveAll().then(function(e){var n=document.createElement("style");return t.appendChild(n),n.appendChild(document.createTextNode(e)),t})}function l(t){return y.inlineAll(t).then(function(){return t})}function f(t,e,n){return Promise.resolve(t).then(function(t){return t.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),(new XMLSerializer).serializeToString(t)}).then(p.escapeXhtml).then(function(t){return'<foreignObject x="0" y="0" width="100%" height="100%">'+t+"</foreignObject>"}).then(function(t){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+e+'" height="'+n+'">'+t+"</svg>"}).then(function(t){return"data:image/svg+xml;charset=utf-8,"+t})}function d(){function t(){var t="application/font-woff",e="image/jpeg";return{woff:t,woff2:t,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:e,jpeg:e,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"}}function e(t){var e=/\.([^\.\/]*?)$/g.exec(t);return e?e[1]:""}function n(n){var r=e(n).toLowerCase();return t()[r]||""}function r(t){return t.search(/^(data:)/)!==-1}function i(t){return new Promise(function(e){for(var n=window.atob(t.toDataURL().split(",")[1]),r=n.length,i=new Uint8Array(r),o=0;o<r;o++)i[o]=n.charCodeAt(o);e(new Blob([i],{type:"image/png"}))})}function o(t){return t.toBlob?new Promise(function(e){t.toBlob(e)}):i(t)}function a(t,e){var n=document.implementation.createHTMLDocument(),r=n.createElement("base");n.head.appendChild(r);var i=n.createElement("a");return n.body.appendChild(i),r.href=e,i.href=t,i.href}function u(){var t=0;return function(){function e(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}return"u"+e()+t++}}function s(t){return new Promise(function(e,n){var r=new Image;r.onload=function(){e(r)},r.onerror=n,r.src=t})}function c(t){var e=3e4;return E.impl.options.cacheBust&&(t+=(/\?/.test(t)?"&":"?")+(new Date).getTime()),new Promise(function(n){function r(){if(4===a.readyState){if(200!==a.status)return void(u?n(u):o("cannot fetch resource: "+t+", status: "+a.status));var e=new FileReader;e.onloadend=function(){var t=e.result.split(/,/)[1];n(t)},e.readAsDataURL(a.response)}}function i(){u?n(u):o("timeout of "+e+"ms occured while fetching resource: "+t)}function o(t){console.error(t),n("")}var a=new XMLHttpRequest;a.onreadystatechange=r,a.ontimeout=i,a.responseType="blob",a.timeout=e,a.open("GET",t,!0),a.send();var u;if(E.impl.options.imagePlaceholder){var s=E.impl.options.imagePlaceholder.split(/,/);s&&s[1]&&(u=s[1])}})}function h(t,e){return"data:"+e+";base64,"+t}function l(t){return t.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")}function f(t){return function(e){return new Promise(function(n){setTimeout(function(){n(e)},t)})}}function d(t){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}function _(t){return t.replace(/#/g,"%23").replace(/\n/g,"%0A")}function g(t){var e=p(t,"border-left-width"),n=p(t,"border-right-width");return t.scrollWidth+e+n}function m(t){var e=p(t,"border-top-width"),n=p(t,"border-bottom-width");return t.scrollHeight+e+n}function p(t,e){var n=window.getComputedStyle(t).getPropertyValue(e);return parseFloat(n.replace("px",""))}return{escape:l,parseExtension:e,mimeType:n,dataAsUrl:h,isDataUrl:r,canvasToBlob:o,resolveUrl:a,getAndEncode:c,uid:u(),delay:f,asArray:d,escapeXhtml:_,makeImage:s,width:g,height:m}}function _(){function t(t){return t.search(i)!==-1}function e(t){for(var e,n=[];null!==(e=i.exec(t));)n.push(e[1]);return n.filter(function(t){return!p.isDataUrl(t)})}function n(t,e,n,r){function i(t){return new RegExp("(url\\(['\"]?)("+p.escape(t)+")(['\"]?\\))","g")}return Promise.resolve(e).then(function(t){return n?p.resolveUrl(t,n):t}).then(r||p.getAndEncode).then(function(t){return p.dataAsUrl(t,p.mimeType(e))}).then(function(n){return t.replace(i(e),"$1"+n+"$3")})}function r(r,i,o){function a(){return!t(r)}return a()?Promise.resolve(r):Promise.resolve(r).then(e).then(function(t){var e=Promise.resolve(r);return t.forEach(function(t){e=e.then(function(e){return n(e,t,i,o)})}),e})}var i=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:r,shouldProcess:t,impl:{readUrls:e,inline:n}}}function g(){function t(){return e(document).then(function(t){return Promise.all(t.map(function(t){return t.resolve()}))}).then(function(t){return t.join("\n")})}function e(){function t(t){return t.filter(function(t){return t.type===CSSRule.FONT_FACE_RULE}).filter(function(t){return v.shouldProcess(t.style.getPropertyValue("src"))})}function e(t){var e=[];return t.forEach(function(t){try{p.asArray(t.cssRules||[]).forEach(e.push.bind(e))}catch(e){console.log("Error while reading CSS rules from "+t.href,e.toString())}}),e}function n(t){return{resolve:function(){var e=(t.parentStyleSheet||{}).href;return v.inlineAll(t.cssText,e)},src:function(){return t.style.getPropertyValue("src")}}}return Promise.resolve(p.asArray(document.styleSheets)).then(e).then(t).then(function(t){return t.map(n)})}return{resolveAll:t,impl:{readAll:e}}}function m(){function t(t){function e(e){return p.isDataUrl(t.src)?Promise.resolve():Promise.resolve(t.src).then(e||p.getAndEncode).then(function(e){return p.dataAsUrl(e,p.mimeType(t.src))}).then(function(e){return new Promise(function(n,r){t.onload=n,t.onerror=r,t.src=e})})}return{inline:e}}function e(n){function r(t){var e=t.style.getPropertyValue("background");return e?v.inlineAll(e).then(function(e){t.style.setProperty("background",e,t.style.getPropertyPriority("background"))}).then(function(){return t}):Promise.resolve(t)}return n instanceof Element?r(n).then(function(){return n instanceof HTMLImageElement?t(n).inline():Promise.all(p.asArray(n.childNodes).map(function(t){return e(t)}))}):Promise.resolve(n)}return{inlineAll:e,impl:{newImage:t}}}var p=d(),v=_(),w=g(),y=m(),b={imagePlaceholder:void 0,cacheBust:!1},E={toSvg:n,toPng:i,toJpeg:o,toBlob:a,toPixelData:r,impl:{fontFaces:w,images:y,util:p,inliner:v,options:{}}};t.exports=E}(this)}]);